<!DOCTYPE html>
<html lang="el">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>AI ÎšÏÎ¹Ï„Î®Ï‚ - Î£Ï‰ÎºÏÎ¬Ï„Î·Ï‚ (Î£Ï„Î±Î¸ÎµÏÎ® Î’Î±Î¸Î¼Î¿Î»Î¿Î³Î¯Î± + Î£Ï‡ÏŒÎ»Î¹Î¿)</title>
  <style> 
    body { font-family: system-ui, Arial, sans-serif; background:#173b88; color:#fff; margin:0; display:flex; align-items:center; justify-content:center; min-height:100vh; }
    .app { background:#0e2a66; border-radius:20px; padding:20px; max-width:420px; width:100%; box-shadow:0 8px 24px rgba(0,0,0,.3); }
    h1 { font-size:22px; margin:0 0 5px 0; }
    h2 { font-size:18px; margin:0 0 12px 0; color:#cfe0ff; }
    select, textarea { width:100%; padding:10px; border-radius:10px; border:0; margin:10px 0; font-size:16px; }
    button { width:100%; padding:14px; border-radius:20px; border:0; font-size:18px; margin:10px 0; cursor:pointer; }
    .btn-primary { background:linear-gradient(135deg,#cde7ff,#caa5ff); color:#000; }
    .btn-secondary { background:linear-gradient(135deg,#6ee0ff,#3db8ff); color:#002140; }
    .panel { background:rgba(255,255,255,.08); border-radius:15px; padding:12px; margin:10px 0; }
    .score { font-size:20px; font-weight:700; text-align:center; margin-top:10px; }
    .tiny { font-size:12px; color:#cfe0ff; opacity:.9 }
    .row { display:flex; gap:8px; }
    .row > * { flex:1; }
    .recording { position: relative; }
    .recording::after{
      content:"";
      position:absolute;
      top:-6px; right:-6px;
      width:12px; height:12px;
      background:#ff4d4d; border-radius:50%;
      box-shadow:0 0 0 0 rgba(255,77,77,0.7);
      animation:pulse 1.4s infinite;
    }
    @keyframes pulse{
      0%{ box-shadow:0 0 0 0 rgba(255,77,77,0.7) }
      70%{ box-shadow:0 0 0 12px rgba(255,77,77,0) }
      100%{ box-shadow:0 0 0 0 rgba(255,77,77,0) }
    }

#timerPanel {
  background: rgba(255, 255, 255, 0.15);
  font-size: 18px;
  text-align: center;
  font-weight: bold;
  margin-top: 10px;
  border-radius: 12px;
  padding: 10px;
}
#timer {
  color: #ffde59;
}

#activePlayerBar .tiny { opacity:.9; }
#activePlayerBar #bonusBtn[disabled] { opacity:.5; cursor:not-allowed; }

/* ÎšÎ¬Î½ÎµÎ¹ Ï„Î¿ setup screen scrollable */
#setupScreen {
  overflow-y: auto;
  max-height: 100vh;
}

/* Î•Î¼Ï†Î¬Î½Î¹ÏƒÎ· ÏŒÏ„Î±Î½ ÎµÏ€Î¹Î»Î­Î³ÎµÏ„Î±Î¹ Î­Î½Î±Ï‚ Ï‡Î±ÏÎ±ÎºÏ„Î®ÏÎ±Ï‚ */
.character.selected {
  outline: 4px solid white;
  transform: scale(1.05);
  transition: 0.2s;
}

  /* === Î”Î¹Î¬Ï„Î±Î¾Î· Ï‡Î±ÏÎ±ÎºÏ„Î®ÏÏ‰Î½ ÏƒÎµ Ï€Î»Î­Î³Î¼Î± === */
#characterSelection {
  display: grid !important;
  grid-template-columns: repeat(2, minmax(120px, 1fr));
  gap: 20px;
  justify-items: center;
  margin-top: 20px;
}

.character {
  background: rgba(255,255,255,0.1);
  border-radius: 15px;
  padding: 10px;
  text-align: center;
  width: 120px;
}

.character img {
  width: 80px;
  height: 80px;
  border-radius: 50%;
  object-fit: contain;
  background-color: #ffffff;
  margin-bottom: 5px;
  padding: 3px;
  transition: transform 0.2s;
}

.character img:hover {
  transform: scale(1.08);
}
    
  </style>
</head>
<body>

<!-- === Î‘Î¡Î§Î™ÎšÎ— ÎŸÎ˜ÎŸÎÎ— (Welcome Screen) === -->
<div id="welcomeScreen" style="
  position:fixed;
  inset:0;
  background:linear-gradient(180deg,#102a6d,#173b88);
  color:white;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:flex-start;
  padding:40px 20px 20px 20px;
  text-align:center;
  z-index:2000;
">
  <img src="images/Socrates.png" alt="Î£Ï‰ÎºÏÎ¬Ï„Î·Ï‚" style="width:160px;height:160px;border-radius:50%;margin-bottom:20px;object-fit:cover;">

  <h1 style="font-size:24px;margin-bottom:10px;">AI ÎšÏÎ¹Ï„Î®Ï‚ - Î£Ï‰ÎºÏÎ¬Ï„Î·Ï‚</h1>
  <p style="font-size:15px;opacity:0.85;margin-bottom:25px;">
    ÎˆÎ½Î± Ï†Î¹Î»Î¿ÏƒÎ¿Ï†Î¹ÎºÏŒ Ï€Î±Î¹Ï‡Î½Î¯Î´Î¹ ÎµÏ€Î¹Ï‡ÎµÎ¹ÏÎ·Î¼Î±Ï„Î¿Î»Î¿Î³Î¯Î±Ï‚ Î³Î¹Î± Ï€Î±Î¹Î´Î¹Î¬ ÎºÎ±Î¹ Î¼ÎµÎ³Î¬Î»Î¿Ï…Ï‚.
  </p>

  <!-- === ÎšÎŸÎ¥ÎœÎ Î™Î‘ Î‘Î¡Î§Î™ÎšÎ—Î£ ÎŸÎ˜ÎŸÎÎ—Î£ (Main Buttons) === -->
  <div class="button-container">
    <button id="goToSetup">ğŸ® ÎÎ­Î¿ Î Î±Î¹Ï‡Î½Î¯Î´Î¹</button>
    <button id="infoButton">â„¹ï¸ Î Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚</button>
  </div>
</div>

<!-- === Î¡Î¥Î˜ÎœÎ™Î£Î•Î™Î£ Î Î‘Î™Î§ÎÎ™Î”Î™ÎŸÎ¥ (Setup Screen) === -->
<div id="setupScreen" style="
  position:fixed;
  inset:0;
  background:rgba(10,20,60,0.95);
  color:white;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:flex-start;
  z-index:1000;
  text-align:center;
  padding:40px 20px 20px 20px;
">

  <h1 style="margin-bottom:20px;">ğŸ® Î¡Ï…Î¸Î¼Î¯ÏƒÎµÎ¹Ï‚ Î Î±Î¹Ï‡Î½Î¹Î´Î¹Î¿Ï</h1>

  <label>Î‘ÏÎ¹Î¸Î¼ÏŒÏ‚ Î Î±Î¹ÎºÏ„ÏÎ½:
    <select id="playerCount" style="margin-left:10px;">
      <option value="2" selected>2</option>
      <option value="3">3</option>
      <option value="4">4</option>
      <option value="5">5</option>
      <option value="6">6</option>
    </select>
  </label>

 <div id="characterSelection" style="margin:20px 0;">

    <!-- Î•Î´Ï Î¸Î± Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î·Î¸Î¿ÏÎ½ Ï„Î± avatars Î´Ï…Î½Î±Î¼Î¹ÎºÎ¬ -->
  </div>

  <label>Î‘ÏÎ¹Î¸Î¼ÏŒÏ‚ Î“ÏÏÏ‰Î½:
    <select id="roundCount" style="margin-left:10px;">
      <option value="1">1</option>
      <option value="2" selected>2</option>
      <option value="3">3</option>
      <option value="4">4</option>
      <option value="5">5</option>
    </select>
  </label>

  <label style="margin-top:15px;">
    <input type="checkbox" id="useBonus" checked>
    Î§ÏÎ®ÏƒÎ· ÎºÎ±ÏÏ„ÏÎ½ +30â€³
  </label>

  <button id="startGameBtn" style="
    margin-top:30px;
    background:linear-gradient(135deg,#ffd166,#ff7e5f);
    border:0;
    border-radius:25px;
    padding:12px 30px;
    font-size:18px;
    cursor:pointer;
    color:#001;
    font-weight:bold;
  ">
    ğŸš€ ÎˆÎ½Î±ÏÎ¾Î· Î Î±Î¹Ï‡Î½Î¹Î´Î¹Î¿Ï
  </button>

</div>

<script>
const characters = [
  { name: "Î›Î¯Î±", color: "#ffd166", img: "images/Lia.png" },
  { name: "Î™Î¬ÏƒÏ‰Î½Î±Ï‚", color: "#06d6a0", img: "images/Jason.png" },
  { name: "Î¤Î¶Î­Î·Î¼Ï‚", color: "#118ab2", img: "images/James.png" },
  { name: "ÎœÎ¬ÏÎºÎ¿Ï‚", color: "#ef476f", img: "images/Marco.png" },
  { name: "Î†Î½Î½Î±", color: "#a29bfe", img: "images/Anna.png" },
  { name: "ÎœÎ­Î¹ Î›Î¹Î½", color: "#ffb6b9", img: "images/May Lin.png" }
];

let selectedCharacters = []; // Î±Ï€Î¿Î¸Î·ÎºÎµÏÎµÎ¹ Ï„Î¹Ï‚ ÎµÏ€Î¹Î»Î¿Î³Î­Ï‚

function renderCharacterSelection() {
  const container = document.getElementById("characterSelection");
  const status = document.createElement("div");
  status.id = "selectionStatus";
  status.style.marginTop = "10px";
  status.style.fontWeight = "bold";
  status.style.textAlign = "center";
  container.after(status);

  container.innerHTML = "";
  characters.forEach(ch => {
    const btn = document.createElement("button");
    btn.innerHTML = `
      <img src="${ch.img}" style="width:60px;height:60px;border-radius:50%;display:block;margin:0 auto 5px;">
      ${ch.name}
    `;
    btn.style.background = ch.color;
    btn.style.border = "none";
    btn.style.color = "#000";
    btn.style.padding = "10px 15px";
    btn.style.borderRadius = "15px";
    btn.style.fontWeight = "700";
    btn.style.cursor = "pointer";
    btn.style.minWidth = "80px";

    btn.dataset.id = ch.name.toLowerCase().replace(/\s+/g,"");
btn.dataset.name = ch.name;
btn.dataset.color = ch.color;
btn.dataset.img = ch.img;
btn.classList.add("character");

btn.addEventListener("click", () => toggleCharacter(ch, btn));

    container.appendChild(btn);
  });

  updateSelectionStatus();
}

function toggleCharacter(ch, btn) {
  const playerSelect = document.getElementById("playerCount");
  const count = parseInt(playerSelect.value);
  const idx = selectedCharacters.findIndex(c => c.name === ch.name);

  if (idx !== -1) {
    // Î‘Î½ ÎµÎ¯Î½Î±Î¹ Î®Î´Î· ÎµÏ€Î¹Î»ÎµÎ³Î¼Î­Î½Î¿Ï‚, Ï„Î¿Î½ Î±Ï†Î±Î¹ÏÎ¿ÏÎ¼Îµ
    selectedCharacters.splice(idx, 1);
    btn.style.outline = "none";
    btn.classList.remove("selected");
  } else {
    // Î‘Î½ Î´ÎµÎ½ ÎµÎ¯Î½Î±Î¹ ÎµÏ€Î¹Î»ÎµÎ³Î¼Î­Î½Î¿Ï‚
    if (selectedCharacters.length >= count) {
      alert(`ÎœÏ€Î¿ÏÎµÎ¯Ï‚ Î½Î± ÎµÏ€Î¹Î»Î­Î¾ÎµÎ¹Ï‚ Î­Ï‰Ï‚ ${count} Ï‡Î±ÏÎ±ÎºÏ„Î®ÏÎµÏ‚.`);
      return; // ÏƒÏ„Î±Î¼Î±Ï„Î¬Î¼Îµ ÎµÎ´Ï
    }
    selectedCharacters.push(ch);
    btn.style.outline = "4px solid white";
    btn.classList.add("selected");
  }

  updateSelectionStatus();
}

function updateSelectionStatus() {
  const count = parseInt(document.getElementById("playerCount").value);
  const status = document.getElementById("selectionStatus");
  status.textContent = count === 1
  ? `ÎˆÏ‡ÎµÎ¹Ï‚ ÎµÏ€Î¹Î»Î­Î¾ÎµÎ¹ ${selectedCharacters.length} Ï‡Î±ÏÎ±ÎºÏ„Î®ÏÎ±.`
  : `ÎˆÏ‡ÎµÎ¹Ï‚ ÎµÏ€Î¹Î»Î­Î¾ÎµÎ¹ ${selectedCharacters.length} Î±Ï€ÏŒ ${count} Ï‡Î±ÏÎ±ÎºÏ„Î®ÏÎµÏ‚.`;


const startBtn = document.getElementById("startGameBtn");
startBtn.disabled = selectedCharacters.length < count;
startBtn.style.opacity = startBtn.disabled ? "0.5" : "1";
}
renderCharacterSelection();

document.getElementById("playerCount").addEventListener("change", () => {
  // Î‘Î½ Î¼ÎµÎ¹Ï‰Î¸ÎµÎ¯ Î¿ Î±ÏÎ¹Î¸Î¼ÏŒÏ‚ Ï€Î±Î¹ÎºÏ„ÏÎ½ ÎºÎ±Î¹ Î­Ï‡Î¿Ï…Î¼Îµ Ï€Î±ÏÎ±Ï€Î¬Î½Ï‰ Ï‡Î±ÏÎ±ÎºÏ„Î®ÏÎµÏ‚, Î±Ï†Î±Î¯ÏÎµÏƒÎ­ Ï„Î¿Ï…Ï‚
  const count = parseInt(document.getElementById("playerCount").value);
  if (selectedCharacters.length > count) {
    selectedCharacters = selectedCharacters.slice(0, count);
  }
  // Î‘Ï†Î±Î¯ÏÎµÏƒÎµ Ï„Î± outlines Î±Ï€ÏŒ ÏŒÏƒÎ¿Ï…Ï‚ â€œÎºÏŒÏ€Î·ÎºÎ±Î½â€
  document.querySelectorAll(".character").forEach(btn => {
    const name = btn.textContent.trim();
    if (!selectedCharacters.find(c => c.name === name)) {
      btn.style.outline = "none";
      btn.classList.remove("selected");
    }
  });
  updateSelectionStatus();
});

</script>

  <div class="app">
  <h1 id="missionTitle">Î‘Ï€Î¿ÏƒÏ„Î¿Î»Î®</h1>
  <h2 id="missionQuestion">â€”</h2>

<div class="panel" id="activePlayerBar">
  <div style="display:flex; align-items:center; gap:10px; justify-content:space-between;">
    <div style="display:flex; align-items:center; gap:10px;">
      <div id="activeAvatar" style="width:36px;height:36px;border-radius:50%;background:#cfe0ff;color:#0e2a66;display:flex;align-items:center;justify-content:center;font-weight:700;">
        Î›
      </div>
      <div>
        <div style="font-weight:700;">Î•Î½ÎµÏÎ³ÏŒÏ‚ Î Î±Î¯ÎºÏ„Î·Ï‚: <span id="activePlayerName">â€”</span></div>
        <div class="tiny">Î“ÏÏÎ¿Ï‚: <span id="roundLabel">1</span>/<span id="roundTotal">2</span></div>
      </div>
    </div>

    <div style="display:flex; gap:8px;">
      <button class="btn-secondary" id="bonusBtn" title="ÎšÎ¬ÏÏ„Î± +30â€³" style="min-width:90px;">+30â€³</button>
      <button class="btn-secondary" id="nextPlayerBtn" style="min-width:150px;">Î•Ï€ÏŒÎ¼ÎµÎ½Î¿Ï‚ Î Î±Î¯ÎºÏ„Î·Ï‚ âŸ¶</button>
    </div>
  </div>
</div>

  <div class="row">
    <select id="missionSelect"></select>
    <select id="langSelect" title="Î“Î»ÏÏƒÏƒÎ± Î‘ÎºÏÏŒÎ±ÏƒÎ·Ï‚">
      <option value="el-GR" selected>Î•Î»Î»Î·Î½Î¹ÎºÎ¬</option>
      <option value="en-US">English</option>
    </select>
  </div>

  <textarea id="transcript" placeholder="ÎœÎ¯Î»Î± ÏƒÏ„Î¿ Î¼Î¹ÎºÏÏŒÏ†Ï‰Î½Î¿ Î® Î³ÏÎ¬ÏˆÎµ ÎµÎ´Ï Ï„Î·Î½ Î±Ï€Î¬Î½Ï„Î·ÏƒÎ· Ï„Î¿Ï… Ï€Î±Î¯ÎºÏ„Î·â€¦"></textarea>

  <button class="btn-primary" id="listenBtn">ğŸ™ï¸ ÎŸ Î£Ï‰ÎºÏÎ¬Ï„Î·Ï‚ Î±ÎºÎ¿ÏÎµÎ¹</button>
  <button class="btn-secondary" id="scoreBtn">âš–ï¸ Î’Î±Î¸Î¼Î¿Î»Î¿Î³Î¯Î±</button>
  <button class="btn-secondary" id="speakBtn">ğŸ”Š Î†ÎºÎ¿Ï… Ï„Î¿Î½ Î£Ï‰ÎºÏÎ¬Ï„Î·</button>

<div class="panel" id="timerPanel">
  â³ Î§ÏÏŒÎ½Î¿Ï‚: <span id="timer">1:30</span>
  <button id="pauseBtn" class="btn-secondary" style="margin-left:10px;min-width:100px;">â¸ï¸ Î Î±ÏÏƒÎ·</button>
</div>

  <div class="panel">
    <strong>Î£Ï‡ÏŒÎ»Î¹Î¿ Î£Ï‰ÎºÏÎ¬Ï„Î·:</strong>
    <div id="socraticComment">â€”</div>
  </div>

<!-- Î‘Î½Î¬Î»Ï…ÏƒÎ· Î’Î±Î¸Î¼Î¿Î»Î¿Î³Î¯Î±Ï‚ Ï€Î¬ÎµÎ¹ ÎµÎ´Ï -->
<div class="panel" id="criteriaPanel">
  <strong>Î‘Î½Î¬Î»Ï…ÏƒÎ· Î’Î±Î¸Î¼Î¿Î»Î¿Î³Î¯Î±Ï‚:</strong>
  <ul id="criteriaList" style="margin:5px 0 0 15px; padding:0;"></ul>
</div>

<div class="panel score" id="totalScore">â€”/10</div>

<script>
/* ---------- Missions ---------- */
const missions = [
  {id:"M-001",title:"Î”Î¯ÎºÎ±Î¹Î¿",question:"Î¤Î¹ ÎµÎ¯Î½Î±Î¹ Î´Î¯ÎºÎ±Î¹Î¿;"},
  {id:"M-002",title:"Î¦Î¹Î»Î¯Î±",question:"Î¤Î¹ ÏƒÎ·Î¼Î±Î¯Î½ÎµÎ¹ Î½Î± ÎµÎ¯Î¼Î±Î¹ Ï†Î¯Î»Î¿Ï‚;"},
  {id:"M-003",title:"Î•Ï€Î¹Ï„Ï…Ï‡Î¯Î±",question:"Î“Î¹Î±Ï„Î¯ Î´ÎµÎ½ Î¼Ï€Î¿ÏÏ Î½Î± Ï„Î± Î­Ï‡Ï‰ ÏŒÎ»Î±;"},
  {id:"M-004",title:"Î•Ï…Î³Î½Ï‰Î¼Î¿ÏƒÏÎ½Î·",question:"Î“Î¹Î±Ï„Î¯ Î»Î­Î¼Îµ \"ÎµÏ…Ï‡Î±ÏÎ¹ÏƒÏ„Ï\";"},
  {id:"M-005",title:"Î‘Î»Î®Î¸ÎµÎ¹Î±",question:"Î ÏÎ­Ï€ÎµÎ¹ Ï€Î¬Î½Ï„Î± Î½Î± Î»Î­Î¼Îµ Ï„Î·Î½ Î±Î»Î®Î¸ÎµÎ¹Î±;"},
  {id:"M-006",title:"Î˜Î¬ÏÏÎ¿Ï‚",question:"Î¤Î¹ ÏƒÎ·Î¼Î±Î¯Î½ÎµÎ¹ Î½Î± ÎµÎ¯ÏƒÎ±Î¹ Î³ÎµÎ½Î½Î±Î¯Î¿Ï‚;"},
  {id:"M-007",title:"Î‘Ï€Î¿Î´Î¿Ï‡Î® Î‰Ï„Ï„Î±Ï‚",question:"Î•Î¯Î½Î±Î¹ Î´Î¯ÎºÎ±Î¹Î¿ Î½Î± Ï‡Î¬Î½Ï‰;"},
  {id:"M-008",title:"Î‘Î³Î¬Ï€Î·",question:"Î ÏÏ‚ Î´ÎµÎ¯Ï‡Î½Î¿Ï…Î¼Îµ ÏŒÏ„Î¹ Î±Î³Î±Ï€Î¬Î¼Îµ;"},
  {id:"M-009",title:"ÎšÎ±Î½ÏŒÎ½ÎµÏ‚",question:"Î“Î¹Î±Ï„Î¯ Ï…Ï€Î¬ÏÏ‡Î¿Ï…Î½ ÎºÎ±Î½ÏŒÎ½ÎµÏ‚;"},
  {id:"M-010",title:"Î•Ï…Ï„Ï…Ï‡Î¯Î±",question:"Î¤Î¹ ÏƒÎµ ÎºÎ¬Î½ÎµÎ¹ Ï€ÏÎ±Î³Î¼Î±Ï„Î¹ÎºÎ¬ Ï‡Î±ÏÎ¿ÏÎ¼ÎµÎ½Î¿;"},
  {id:"M-011",title:"Î•Î»Ï€Î¯Î´Î±/ÎŒÎ½ÎµÎ¹ÏÎ±",question:"Î“Î¹Î±Ï„Î¯ ÎµÎ¯Î½Î±Î¹ ÏƒÎ·Î¼Î±Î½Ï„Î¹ÎºÏŒ Î½Î± Î¿Î½ÎµÎ¹ÏÎµÏÎµÏƒÎ±Î¹;"},
  {id:"M-012",title:"Î ÏÎ±Î³Î¼Î±Ï„Î¹ÎºÏŒÏ„Î·Ï„Î±",question:"Î¤Î¹ ÎµÎ¯Î½Î±Î¹ Î±Î»Î·Î¸Î¹Î½ÏŒ;"},
  {id:"M-013",title:"Î£ÎµÎ²Î±ÏƒÎ¼ÏŒÏ‚",question:"Î ÏÏ‚ Î´ÎµÎ¯Ï‡Î½ÎµÎ¹Ï‚ ÏƒÎµÎ²Î±ÏƒÎ¼ÏŒ;"},
  {id:"M-014",title:"Î‘Ï…Ï„Î¿ÏƒÏ…Î½ÎµÎ¯Î´Î·ÏƒÎ·",question:"Î ÏÏ‚ Î¾Î­ÏÏ‰ Ï€Î¿Î¹Î¿Ï‚ ÎµÎ¯Î¼Î±Î¹;"},
  {id:"M-015",title:"Î–Î®Î»ÎµÎ¹Î±",question:"Î•Î¯Î½Î±Î¹ ÎºÎ±ÎºÏŒ Î½Î± Î¶Î·Î»ÎµÏÏ‰;"},
  {id:"M-016",title:"ÎšÎ±Î»Î¿ÏƒÏÎ½Î·",question:"Î¤Î¹ ÏƒÎ·Î¼Î±Î¯Î½ÎµÎ¹ Î½Î± ÎµÎ¯Î¼Î±Î¹ ÎºÎ±Î»ÏŒÏ‚;"},
  {id:"M-017",title:"Î•Î»ÎµÏ…Î¸ÎµÏÎ¯Î±",question:"Î¤Î¹ ÎµÎ¯Î½Î±Î¹ Î· Î•Î»ÎµÏ…Î¸ÎµÏÎ¯Î±;"},
  {id:"M-018",title:"Î¨Ï…Ï‡Î®",question:"Î¥Ï€Î¬ÏÏ‡ÎµÎ¹ Î¨Ï…Ï‡Î®;"},
  {id:"M-019",title:"ÎÏŒÎ·Î¼Î± Ï„Î·Ï‚ Î–Ï‰Î®Ï‚",question:"ÎˆÏ‡ÎµÎ¹ Î½ÏŒÎ·Î¼Î± Î· Î–Ï‰Î®;"},
  {id:"M-020",title:"Î£Ï‰ÏƒÏ„ÏŒ-Î›Î¬Î¸Î¿Ï‚",question:"Î Î¿Î¹Î¿Ï‚ Î±Ï€Î¿Ï†Î±ÏƒÎ¯Î¶ÎµÎ¹ Ï„Î¹ ÎµÎ¯Î½Î±Î¹ ÏƒÏ‰ÏƒÏ„ÏŒ;"},
  {id:"M-021",title:"Î¤ÎµÏ‡Î½Î·Ï„Î® ÎÎ¿Î·Î¼Î¿ÏƒÏÎ½Î·",question:"Î ÏŒÏƒÎ· Î¤ÎµÏ‡Î½Î·Ï„Î® ÎÎ¿Î·Î¼Î¿ÏƒÏÎ½Î· ÎµÎ¯Î½Î±Î¹ Î±ÏÎºÎµÏ„Î®;"}
];

/* ---------- Î¡Î®ÏƒÎµÎ¹Ï‚ Î±Î½Î¬ Î‘Ï€Î¿ÏƒÏ„Î¿Î»Î® ---------- */
const quotesByMission = {
  "M-001": [
    { author: "Î Î»Î¬Ï„Ï‰Î½", quote: "ÎŸ Î´Î¯ÎºÎ±Î¹Î¿Ï‚ Î¬Î½Î¸ÏÏ‰Ï€Î¿Ï‚ Î´ÎµÎ½ Î²Î»Î¬Ï€Ï„ÎµÎ¹ Ï€Î¿Ï„Î­ ÎºÎ±Î½Î­Î½Î±Î½. (Î Î¿Î»Î¹Ï„ÎµÎ¯Î±)" },
    { author: "Î‘ÏÎ¹ÏƒÏ„Î¿Ï„Î­Î»Î·Ï‚", quote: "Î¤Î¿ Î´Î¯ÎºÎ±Î¹Î¿ ÎµÎ¯Î½Î±Î¹ Î· Î±ÏÏ‡Î® Ï„Î·Ï‚ Ï€Î¿Î»Î¹Ï„Î¹ÎºÎ®Ï‚ Î±ÏÎµÏ„Î®Ï‚. (Î—Î¸Î¹ÎºÎ¬ ÎÎ¹ÎºÎ¿Î¼Î¬Ï‡ÎµÎ¹Î±)" }
  ],
  "M-002": [
    { author: "Î‘ÏÎ¹ÏƒÏ„Î¿Ï„Î­Î»Î·Ï‚", quote: "Î— Ï†Î¹Î»Î¯Î± ÎµÎ¯Î½Î±Î¹ Î¼Î¯Î± ÏˆÏ…Ï‡Î® ÏƒÎµ Î´ÏÎ¿ ÏƒÏÎ¼Î±Ï„Î±." },
    { author: "Î•Ï€Î¯ÎºÎ¿Ï…ÏÎ¿Ï‚", quote: "Î‘Ï€ÏŒ ÏŒÎ»Î± ÏŒÏƒÎ± Î· ÏƒÎ¿Ï†Î¯Î± Î¼Î¬Ï‚ Ï‡Î±ÏÎ¯Î¶ÎµÎ¹ Î³Î¹Î± Ï„Î·Î½ ÎµÏ…Ï„Ï…Ï‡Î¯Î±, Ï„Î¿ Ï€Î¿Î»Ï…Ï„Î¹Î¼ÏŒÏ„ÎµÏÎ¿ ÎµÎ¯Î½Î±Î¹ Î· Ï†Î¹Î»Î¯Î±." }
  ],
  "M-005": [
    { author: "Î Î»Î¬Ï„Ï‰Î½", quote: "Î— Î±Î»Î®Î¸ÎµÎ¹Î± ÎµÎ¯Î½Î±Î¹ Î¿ Î®Î»Î¹Î¿Ï‚ Ï„Î¿Ï… Î½Î¿Ï…." },
    { author: "Î£Ï‰ÎºÏÎ¬Ï„Î·Ï‚", quote: "ÎˆÎ½Î± Î¼ÏŒÎ½Î¿ Î¾Î­ÏÏ‰: ÏŒÏ„Î¹ Î´ÎµÎ½ Î¾Î­ÏÏ‰ Ï„Î¯Ï€Î¿Ï„Î±. (Î‘Ï€Î¿Î»Î¿Î³Î¯Î±)" }
  ],
  "M-006": [
    { author: "Î‘ÏÎ¹ÏƒÏ„Î¿Ï„Î­Î»Î·Ï‚", quote: "Î— Î±Î½Î´ÏÎµÎ¯Î± ÎµÎ¯Î½Î±Î¹ Ï„Î¿ Î¼Î­ÏƒÎ¿ Î±Î½Î¬Î¼ÎµÏƒÎ± ÏƒÏ„Î¿Î½ Ï†ÏŒÎ²Î¿ ÎºÎ±Î¹ Ï„Î·Î½ Ï„ÏŒÎ»Î¼Î·." }
  ],
  "M-010": [
    { author: "Î‘ÏÎ¹ÏƒÏ„Î¿Ï„Î­Î»Î·Ï‚", quote: "Î— ÎµÏ…Ï„Ï…Ï‡Î¯Î± ÎµÎ¯Î½Î±Î¹ Ï„Î¿ Ï„ÎµÎ»Î¹ÎºÏŒ Î±Î³Î±Î¸ÏŒ ÏƒÏ„Î¿ Î¿Ï€Î¿Î¯Î¿ Î±Ï€Î¿Î²Î»Î­Ï€Î¿Ï…Î½ ÏŒÎ»ÎµÏ‚ Î¿Î¹ Ï€ÏÎ¬Î¾ÎµÎ¹Ï‚ Î¼Î±Ï‚." },
    { author: "Î•Ï€Î¯ÎºÎ¿Ï…ÏÎ¿Ï‚", quote: "Î— ÎµÏ…Ï„Ï…Ï‡Î¯Î± Î´ÎµÎ½ Î­ÏÏ‡ÎµÏ„Î±Î¹ Î¼Îµ Ï„Î± Ï€Î»Î¿ÏÏ„Î·, Î±Î»Î»Î¬ Î¼Îµ Ï„Î· Î³Î±Î»Î®Î½Î· Ï„Î·Ï‚ ÏˆÏ…Ï‡Î®Ï‚." }
  ],
  "M-017": [
    { author: "Î•Ï€Î¯ÎºÏ„Î·Ï„Î¿Ï‚", quote: "Î•Î»ÎµÏÎ¸ÎµÏÎ¿Ï‚ ÎµÎ¯Î½Î±Î¹ ÏŒÏ€Î¿Î¹Î¿Ï‚ Î´ÎµÎ½ ÎµÎ¾Î±ÏÏ„Î¬Ï„Î±Î¹ Î±Ï€ÏŒ Ï„Î± Ï€Î¬Î¸Î· Ï„Î¿Ï…." },
    { author: "Î Î»Î¬Ï„Ï‰Î½", quote: "Î— ÎµÎ»ÎµÏ…Î¸ÎµÏÎ¯Î± ÎµÎ¯Î½Î±Î¹ Î· Ï„Î¬Î¾Î· Ï„Î·Ï‚ ÏˆÏ…Ï‡Î®Ï‚ Ï€Î¿Ï… Î³Î½Ï‰ÏÎ¯Î¶ÎµÎ¹ Ï„Î¿ Î´Î¯ÎºÎ±Î¹Î¿." }
  ],
  "M-019": [
    { author: "Î‘ÏÎ¹ÏƒÏ„Î¿Ï„Î­Î»Î·Ï‚", quote: "Î¤Î¿ Î½ÏŒÎ·Î¼Î± Ï„Î·Ï‚ Î¶Ï‰Î®Ï‚ ÎµÎ¯Î½Î±Î¹ Î½Î± Î²ÏÎµÎ¹Ï‚ Ï„Î¿Î½ ÏƒÎºÎ¿Ï€ÏŒ ÏƒÎ¿Ï… ÎºÎ±Î¹ Î½Î± Ï„Î¿Ï… Î±Ï†Î¹ÎµÏÏ‰Î¸ÎµÎ¯Ï‚." },
    { author: "Î£Ï‰ÎºÏÎ¬Ï„Î·Ï‚", quote: "ÎœÎ· Î¶ÎµÎ¹Ï‚ Ï‡Ï‰ÏÎ¯Ï‚ Î½Î± ÎµÎ¾ÎµÏ„Î¬Î¶ÎµÎ¹Ï‚ Ï„Î· Î¶Ï‰Î® ÏƒÎ¿Ï…. (Î‘Ï€Î¿Î»Î¿Î³Î¯Î±)" }
  ]
};
  
/* ---------- Game state ---------- */
const game = {
  players: [
    { id: 'p1', name: 'Î›Î¯Î±', color: '#ffd166', bonusLeft: 1 },
    { id: 'p2', name: 'Î™Î¬ÏƒÏ‰Î½Î±Ï‚', color: '#06d6a0', bonusLeft: 1 }
  ],
  currentRound: 1,
  totalRounds: 2,
  activeIndex: 0,
  baseTimeSec: 90,
   scores: {}   // âœ… ÎµÎ´Ï Î´Î·Î»ÏÎ½Î¿Ï…Î¼Îµ Ï„Î¿Î½ Ï‡ÏÏÎ¿ ÏŒÏ€Î¿Ï… Î¸Î± Î±Ï€Î¿Î¸Î·ÎºÎµÏÎ¿Î½Ï„Î±Î¹ Î¿Î¹ Î²Î±Î¸Î¼Î¿Î»Î¿Î³Î¯ÎµÏ‚
};

function renderActivePlayer() {
  const p = game.players[game.activeIndex];
  document.getElementById('activePlayerName').textContent = p.name;
  document.getElementById('activeAvatar').textContent = p.name[0] || 'Î ';
  document.getElementById('activeAvatar').style.background = p.color || '#cfe0ff';
  document.getElementById('roundLabel').textContent = game.currentRound;
  document.getElementById('roundTotal').textContent = game.totalRounds;
  const bonusBtn = document.getElementById('bonusBtn');
  bonusBtn.disabled = p.bonusLeft <= 0;
}

function loadMissions(){
  const sel = document.getElementById("missionSelect");
  sel.innerHTML = "";
  missions.forEach(m=>{
    const opt = document.createElement("option");
    opt.value = m.id;
    opt.textContent = `${m.id} â€” ${m.title}`;
    sel.appendChild(opt);
  });
  renderMission(missions[0].id);
}

function renderMission(id){
  const m = missions.find(x=>x.id===id);
  document.getElementById("missionTitle").textContent = `Î‘Ï€Î¿ÏƒÏ„Î¿Î»Î® ${m.id}`;
  document.getElementById("missionQuestion").textContent = `${m.title}: ${m.question}`;
  document.getElementById("missionSelect").value = id;
}
  
/* ---------- Advance turn & round ---------- */
function advanceTurn() {
  // Î ÏÎ¿Ï‡ÏÏÎ·ÏƒÎµ ÏƒÏ„Î¿Î½ ÎµÏ€ÏŒÎ¼ÎµÎ½Î¿ Ï€Î±Î¯ÎºÏ„Î·
  game.activeIndex = (game.activeIndex + 1) % game.players.length;

  // Î‘Î½ Î³Ï…ÏÎ¯ÏƒÎ±Î¼Îµ ÏƒÏ„Î¿Î½ Ï€ÏÏÏ„Î¿ Ï€Î±Î¯ÎºÏ„Î·, ÏƒÎ·Î¼Î±Î¯Î½ÎµÎ¹ ÏŒÏ„Î¹ Î¿Î»Î¿ÎºÎ»Î·ÏÏÎ¸Î·ÎºÎµ Î­Î½Î±Ï‚ Î³ÏÏÎ¿Ï‚
  if (game.activeIndex === 0 && game.currentRound < game.totalRounds) {
    game.currentRound++;
  }

  // Î‘Î½ Ï†Ï„Î¬ÏƒÎ±Î¼Îµ ÏƒÏ„Î¿Î½ Ï„ÎµÎ»ÎµÏ…Ï„Î±Î¯Î¿ Ï€Î±Î¯ÎºÏ„Î· Ï„Î¿Ï… Ï„ÎµÎ»ÎµÏ…Ï„Î±Î¯Î¿Ï… Î³ÏÏÎ¿Ï… âœ Î´ÎµÎ¯Î¾Îµ Î±Ï€Î¿Ï„ÎµÎ»Î­ÏƒÎ¼Î±Ï„Î±
  if (game.currentRound === game.totalRounds && game.activeIndex === 0) {
    showResultsSummary();
    return; // ÏƒÏ„Î±Î¼Î±Ï„Î¬ ÎµÎ´Ï, Î´ÎµÎ½ Ï‡ÏÎµÎ¹Î¬Î¶ÎµÏ„Î±Î¹ Î½Î± Ï€Î¬ÎµÎ¹ ÏƒÎµ Î½Î­Î¿ Î³ÏÏÎ¿
  }
  
  // Î•Î½Î·Î¼Î­ÏÏ‰ÏƒÎµ Ï„Î·Î½ Î¿Î¸ÏŒÎ½Î·
  renderActivePlayer();
}

/* ---------- Î‘Ï€Î¿Ï„ÎµÎ»Î­ÏƒÎ¼Î±Ï„Î± Î‘Ï€Î¿ÏƒÏ„Î¿Î»Î®Ï‚ ---------- */
function showResultsSummary() {
  // âœ… Î¥Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼ÏŒÏ‚ Ï„ÎµÎ»Î¹ÎºÏÎ½ ÏƒÎºÎ¿Ï Î±Ï€ÏŒ Ï„Î¿ game.scores
  const totalScores = {};
  game.players.forEach(p => {
    const arr = game.scores[p.name] || [];
    const sum = arr.reduce((a, b) => a + b, 0);
    totalScores[p.name] = sum;
  });

  // âœ… Î’ÏÎµÏ‚ Ï„Î¿Î½ Î½Î¹ÎºÎ·Ï„Î® (Î¼Îµ Ï„Î¿ Î¼ÎµÎ³Î±Î»ÏÏ„ÎµÏÎ¿ Î¬Î¸ÏÎ¿Î¹ÏƒÎ¼Î±)
  const winner = Object.keys(totalScores).reduce((a, b) =>
    totalScores[a] > totalScores[b] ? a : b
  );

 // âœ… Î•Ï€Î¹Î»Î¿Î³Î® ÏÎ®ÏƒÎ·Ï‚ Î±Î½Î¬Î»Î¿Î³Î± Î¼Îµ Ï„Î·Î½ Î‘Ï€Î¿ÏƒÏ„Î¿Î»Î®
const currentMission = document.getElementById("missionSelect").value;
const availableQuotes = quotesByMission[currentMission] || [];

let selectedQuote = "ÎŸ Î´Î¹Î¬Î»Î¿Î³Î¿Ï‚ ÎµÎ¯Î½Î±Î¹ Î· Î±ÏÏ‡Î® Ï„Î·Ï‚ ÏƒÎ¿Ï†Î¯Î±Ï‚.";
if (availableQuotes.length > 0) {
  const random = Math.floor(Math.random() * availableQuotes.length);
  selectedQuote = `Â«${availableQuotes[random].quote}Â» â€” ${availableQuotes[random].author}`;
}

document.getElementById("socratesQuote").textContent = selectedQuote;

  // âœ… Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Î»Î¯ÏƒÏ„Î±Ï‚ Î¼Îµ Ï„Î± Î±Ï€Î¿Ï„ÎµÎ»Î­ÏƒÎ¼Î±Ï„Î±
  let html = "<ul style='list-style:none; padding:0;'>";
  for (let p in totalScores) {
    const arr = game.scores[p] || [];
    const average = (arr.reduce((a, b) => a + b, 0) / arr.length).toFixed(1);
    html += `<li><strong>${p}</strong>: ${totalScores[p]} Ï€ÏŒÎ½Ï„Î¿Î¹ (Îœ.ÎŸ.: ${average})</li>`;
  }
  html += `</ul><p style="margin-top:15px;">ğŸ† ÎÎ¹ÎºÎ·Ï„Î®Ï‚: <strong>${winner}</strong></p>`;

  // âœ… Î•Î¼Ï†Î¬Î½Î¹ÏƒÎ·
  document.getElementById("resultsSummary").innerHTML = html;
  document.getElementById("resultModal").style.display = "flex";

  // âœ… Î‰Ï‡Î¿Ï‚
  const audio = new Audio("sounds/philosophical_chime.mp3");
  audio.play();

  // âœ… ÎšÎ¿Ï…Î¼Ï€Î¯ â€œÎ•Ï€ÏŒÎ¼ÎµÎ½Î· Î‘Ï€Î¿ÏƒÏ„Î¿Î»Î®â€
  document.getElementById("nextMissionBtn").onclick = () => {
    document.getElementById("resultModal").style.display = "none";
  };
}
  
  /* ---------- Timer ---------- */
let timerInterval = null;
let isTimerRunning = false;
let remainigTime = 90;
let isPaused = false;

function startTimer(durationSec = 90) {
  clearInterval(timerInterval);
  isTimerRunning = true;
  isPaused = false;
  remainingTime = durationSec; // âœ… ÏƒÏ‰ÏƒÏ„ÏŒ ÏŒÎ½Î¿Î¼Î± Î¼ÎµÏ„Î±Î²Î»Î·Ï„Î®Ï‚

  function updateDisplay() {
    const minutes = Math.floor(remainingTime / 60);
    const seconds = remainingTime % 60;
    document.getElementById("timer").textContent =
      `${minutes}:${seconds.toString().padStart(2, "0")}`;
  }

  updateDisplay();
  timerInterval = setInterval(() => {
    if (isPaused) return; // â¸ï¸ Î´ÎµÎ½ Î¼ÎµÎ¹ÏÎ½ÎµÎ¹ Ï‡ÏÏŒÎ½Î¿ Î±Î½ Î­Ï‡ÎµÎ¹ Ï€Î±ÏÏƒÎ·
    remainingTime--;

    if (remainingTime < 0) {
      clearInterval(timerInterval);
      isTimerRunning = false;
      document.getElementById("timer").textContent = "â° Î¤Î­Î»Î¿Ï‚!";
      const audio = new Audio("sounds/philosophical_chime.mp3");
      audio.play();
      try { if (recognition && recognizing) recognition.stop(); } catch (e) {}

      advanceTurn();  // âœ… ÎµÎ½Î·Î¼ÎµÏÏÎ½ÎµÎ¹ Î±Ï…Ï„ÏŒÎ¼Î±Ï„Î± Ï€Î±Î¯ÎºÏ„Î· & Î³ÏÏÎ¿
      return;
    }

    updateDisplay();
  }, 1000);
}

   /* ---------- Pause / Resume button ---------- */
document.getElementById("pauseBtn").addEventListener("click", () => {
  if (!isTimerRunning) return;
  isPaused = !isPaused;
  document.getElementById("pauseBtn").textContent = isPaused ? "â–¶ï¸ Î£Ï…Î½Î­Ï‡ÎµÎ¹Î±" : "â¸ï¸ Î Î±ÏÏƒÎ·";
});

/* ---------- Text-to-Speech (Socrates) ---------- */
document.getElementById("speakBtn").addEventListener("click", ()=>{
  const comment = document.getElementById("socraticComment").textContent.trim();
  if(!comment || comment==="â€”"){ 
    alert("Î”ÎµÎ½ Ï…Ï€Î¬ÏÏ‡ÎµÎ¹ ÏƒÏ‡ÏŒÎ»Î¹Î¿ Î³Î¹Î± Î½Î± Î´Î¹Î±Î²Î±ÏƒÏ„ÎµÎ¯.");
    return;
  }
  const utterance = new SpeechSynthesisUtterance(comment);
  const voices = speechSynthesis.getVoices();
  const greekVoice = voices.find(v => v.lang.startsWith("el"));
  if(greekVoice) utterance.voice = greekVoice;
  speechSynthesis.speak(utterance);
});

/* ---------- Speech-to-Text ---------- */
const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
let recognition = null;
let recognizing = false;
let finalTranscript = "";
let shouldListen = false; // Î³Î¹Î± Î±Ï…Ï„ÏŒÎ¼Î±Ï„Î· ÎµÏ€Î±Î½ÎµÎºÎºÎ¯Î½Î·ÏƒÎ· ÏŒÏƒÎ¿ â€œÏ„ÏÎ­Ï‡ÎµÎ¹â€ Î¿ Î³ÏÏÎ¿Ï‚

function initSTT(){
  if(!SpeechRecognition){
    alert("ÎŸ browser Î´ÎµÎ½ Ï…Ï€Î¿ÏƒÏ„Î·ÏÎ¯Î¶ÎµÎ¹ Speech Recognition. Î ÏÏŒÏ„ÎµÎ¹Î½ÎµÏ„Î±Î¹ Chrome ÏƒÎµ desktop/Android.");
    return;
  }
  recognition = new SpeechRecognition();
  recognition.continuous = true;
  recognition.interimResults = true;
  recognition.lang = document.getElementById("langSelect").value;

  recognition.onstart = () => {
    recognizing = true;
    document.getElementById("listenBtn").classList.add("recording");
    document.getElementById("listenBtn").textContent = "â–  Î£Ï„Î±Î¼Î¬Ï„Î± Ï„Î·Î½ Î±ÎºÏÏŒÎ±ÏƒÎ·";
  };

  recognition.onend = () => {
    recognizing = false;
    // Î±Î½ Î¿ Ï‡ÏÏŒÎ½Î¿Ï‚ â€œÏ„ÏÎ­Ï‡ÎµÎ¹â€ ÎºÎ±Î¹ Î¸Î­Î»Î¿Ï…Î¼Îµ Î½Î± ÏƒÏ…Î½ÎµÏ‡Î¯ÏƒÎµÎ¹ Î· Î±ÎºÏÏŒÎ±ÏƒÎ·, Î¾Î±Î½Î±Î¾ÎµÎºÎ¯Î½Î±
    if (shouldListen && isTimerRunning) {
      try { recognition.start(); return; } catch(e) {}
    }
    // Î±Î»Î»Î¹ÏÏ‚, ÎµÏ€Î±Î½Î¬Ï†ÎµÏÎµ Ï„Î¿ ÎºÎ¿Ï…Î¼Ï€Î¯
    document.getElementById("listenBtn").classList.remove("recording");
    document.getElementById("listenBtn").textContent = "ğŸ™ï¸ ÎŸ Î£Ï‰ÎºÏÎ¬Ï„Î·Ï‚ Î±ÎºÎ¿ÏÎµÎ¹";
  };

  recognition.onerror = (e) => {
    console.warn("STT error:", e.error);
  };

  recognition.onresult = (event) => {
    let interim = "";
    for (let i = event.resultIndex; i < event.results.length; i++) {
      const res = event.results[i];
      if (res.isFinal) finalTranscript += res[0].transcript + " ";
      else interim += res[0].transcript;
    }
    document.getElementById("transcript").value = (finalTranscript + " " + interim).trim();
  };
}

document.getElementById("langSelect").addEventListener("change", () => {
  if(recognition){ recognition.lang = document.getElementById("langSelect").value; }
});
 
/* ---------- Listen button ---------- */
document.getElementById("listenBtn").addEventListener("click", ()=>{
  if(!recognition){ initSTT(); }
  if(!recognition){ return; }

  if(!recognizing){
    shouldListen = true;
    finalTranscript = document.getElementById("transcript").value.trim() + " ";
    recognition.start();
    startTimer(game.baseTimeSec || 90);
  }else{
    shouldListen = false;
    recognition.stop();
    clearInterval(timerInterval);
    isTimerRunning = false;
  }
});

/* ---------- Mission select ---------- */
document.getElementById("missionSelect").addEventListener("change", (e)=>{
  renderMission(e.target.value);
});

/* ---------- Start timer on typing ---------- */
document.getElementById("transcript").addEventListener("input", () => {
  if (!isTimerRunning) {
    startTimer(game.baseTimeSec || 90);
  }
});

/* ---------- Server calls ---------- */
async function getScore(transcript, mission) {
  try {
    const response = await fetch("/api/score", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ type: "score", transcript, mission })
    });
    const data = await response.json();
    return data;
  } catch (err) {
    return { error: "Î£Ï†Î¬Î»Î¼Î± ÏƒÏ„Î· Î²Î±Î¸Î¼Î¿Î»Î¿Î³Î¯Î±.", raw: String(err) };
  }
}

async function getComment(transcript, mission) {
  try {
    const response = await fetch("/api/score", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ type: "comment", transcript, mission })
    });
    const data = await response.json();
    return data.comment || "â€”";
  } catch (err) {
    return "Î£Ï†Î¬Î»Î¼Î± ÏƒÏ„Î¿ ÏƒÏ‡ÏŒÎ»Î¹Î¿.";
  }
}

/* ---------- Score button ---------- */
document.getElementById("scoreBtn").addEventListener("click", async ()=>{
  const transcript = document.getElementById("transcript").value.trim();
  const missionId = document.getElementById("missionSelect").value;
  const mission = missions.find(m=>m.id===missionId);

  const scores = await getScore(transcript, mission);
  const comment = await getComment(transcript, mission);

  if(scores.error){
    document.getElementById("socraticComment").textContent = scores.error;
    document.getElementById("totalScore").textContent = "--/10";
    document.getElementById("criteriaList").innerHTML = "";
    return;
  }

  document.getElementById("socraticComment").textContent = comment;

  const criteriaList = document.getElementById("criteriaList");
  criteriaList.innerHTML = "";
  if(scores.criteria){
    for(const [k,v] of Object.entries(scores.criteria)){
      const li = document.createElement("li");
      li.textContent = `${k}: ${v}/2`;
      criteriaList.appendChild(li);
    }
  }
  document.getElementById("totalScore").textContent = scores.total + "/10";
  
  // âœ… Î‘Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ· ÏƒÎºÎ¿Ï Î±Î½Î¬ Ï€Î±Î¯ÎºÏ„Î·
  const activePlayer = game.players[game.activeIndex].name;
  if (!game.scores[activePlayer]) game.scores[activePlayer] = [];
  game.scores[activePlayer].push(scores.total);
});

/* ---------- Next player / Bonus ---------- */
document.getElementById('nextPlayerBtn').addEventListener('click', ()=>{
  clearInterval(timerInterval);
  isTimerRunning = false;
  isPaused = false;
  remainingTime = game.baseTimeSec; // ÎµÏ€Î±Î½Î±Ï†Î¿ÏÎ¬ Ï‡ÏÏŒÎ½Î¿Ï…

  advanceTurn(); // âœ… ÎµÎ½Î¹Î±Î¯Î± Î»Î¿Î³Î¹ÎºÎ® Î±Î»Î»Î±Î³Î®Ï‚ Ï€Î±Î¯ÎºÏ„Î· ÎºÎ±Î¹ Î³ÏÏÎ¿Ï…
  document.getElementById("timer").textContent = "1:30";
});

document.getElementById('bonusBtn').addEventListener('click', ()=>{
  const p = game.players[game.activeIndex];
  if(p.bonusLeft > 0){
    p.bonusLeft--;
    const timerEl = document.getElementById("timer").textContent;
    if(/^\d+:\d+$/.test(timerEl)){
      const [min, sec] = timerEl.split(":").map(Number);
      let remainigTime = min*60 + sec + 30;
      startTimer(remainigTime);
    }
    renderActivePlayer();
  }
});

/* ---------- Boot ---------- */
loadMissions();
renderActivePlayer();

/* ---------- Start Game (setup â†’ app) ---------- */
document.getElementById("startGameBtn").addEventListener("click", () => {
  const playerCount = parseInt(document.getElementById("playerCount").value);
  const roundCount = parseInt(document.getElementById("roundCount").value);
  const useBonus = document.getElementById("useBonus").checked;

  const selected = Array.from(document.querySelectorAll(".character.selected"));
  if (selected.length < playerCount) {
    alert("Î Î±ÏÎ±ÎºÎ±Î»Ï ÎµÏ€Î¯Î»ÎµÎ¾Îµ ÏŒÏƒÎ¿Ï…Ï‚ Ï‡Î±ÏÎ±ÎºÏ„Î®ÏÎµÏ‚ ÏŒÏƒÎ¿Î¹ ÎµÎ¯Î½Î±Î¹ Î¿Î¹ Ï€Î±Î¯ÎºÏ„ÎµÏ‚!");
    return;
  }

  game.players = selected.slice(0, playerCount).map(el => ({
    id: el.dataset.id,
    name: el.dataset.name,
    color: el.dataset.color,
    img: el.dataset.img,
    bonusLeft: useBonus ? 1 : 0
  }));
  game.currentRound = 1;
  game.totalRounds = roundCount;
  game.activeIndex = 0;

  document.getElementById("setupScreen").style.display = "none";
  renderActivePlayer();
});

/* ---------- Welcome â†’ Setup ---------- */
document.getElementById("goToSetup").addEventListener("click", () => {
  document.getElementById("welcomeScreen").style.display = "none";
  document.getElementById("setupScreen").style.display = "flex";
});

/* ---------- Info ---------- */
document.getElementById("infoButton").addEventListener("click", () => {
  alert("ğŸ“œ ÎŸÎ´Î·Î³Î¯ÎµÏ‚ Î Î±Î¹Ï‡Î½Î¹Î´Î¹Î¿Ï:\n\n1ï¸âƒ£ Î•Ï€Î¯Î»ÎµÎ¾Îµ Ï€Î±Î¯ÎºÏ„ÎµÏ‚ ÎºÎ±Î¹ Î³ÏÏÎ¿Ï…Ï‚.\n2ï¸âƒ£ ÎœÎ¯Î»Î± Î® Î³ÏÎ¬ÏˆÎµ Ï„Î·Î½ Î±Ï€Î¬Î½Ï„Î·ÏƒÎ· Ï„Î¿Ï… Ï€Î±Î¯ÎºÏ„Î·.\n3ï¸âƒ£ ÎŸ Î£Ï‰ÎºÏÎ¬Ï„Î·Ï‚ Î¸Î± Ï„Î· Î²Î±Î¸Î¼Î¿Î»Î¿Î³Î®ÏƒÎµÎ¹ ÎºÎ±Î¹ Î¸Î± ÏƒÏ‡Î¿Î»Î¹Î¬ÏƒÎµÎ¹.\n\nÎšÎ±Î»Î® Î´Î¹Î±ÏƒÎºÎ­Î´Î±ÏƒÎ·!");
});

</script>
  
<!-- === MODAL Î‘ÎÎ‘ÎšÎŸÎ™ÎÎ©Î£Î—Î£ Î‘Î ÎŸÎ¤Î•Î›Î•Î£ÎœÎ‘Î¤ÎŸÎ£ === -->
<div id="resultModal" style="
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.85);
  display:none;
  justify-content:center;
  align-items:center;
  z-index:3000;
  color:white;
  font-family: system-ui, Arial;
  text-align:center;
  padding:20px;
">
  <div style="background:#142f70; border-radius:20px; padding:30px; max-width:600px; box-shadow:0 0 30px rgba(0,0,0,0.4);">
    <h2>ğŸ›ï¸ ÎŸ Î£Ï‰ÎºÏÎ¬Ï„Î·Ï‚ Î»Î­ÎµÎ¹:</h2>
    <p id="socratesQuote" style="font-style:italic; font-size:1.2em; margin:20px 0;"></p>
    <h3>ğŸ“œ Î‘Ï€Î¿Ï„ÎµÎ»Î­ÏƒÎ¼Î±Ï„Î± Î‘Ï€Î¿ÏƒÏ„Î¿Î»Î®Ï‚</h3>
    <div id="resultsSummary" style="margin-top:10px;"></div>
    <button id="nextMissionBtn" style="
      margin-top:25px;
      background:#f2c14e;
      border:none;
      padding:12px 25px;
      border-radius:10px;
      font-weight:bold;
      cursor:pointer;
      color:#000;
    ">Î•Ï€ÏŒÎ¼ÎµÎ½Î· Î‘Ï€Î¿ÏƒÏ„Î¿Î»Î®</button>
  </div>
</div>

  

</body>
</html>
